---
import Image from '../../components/Image.svelte';
import SpaceLayout from '../../layouts/SpaceLayout.astro';
import Button from '../../components/Button.astro';
const NASA_API_KEY = import.meta.env.NASA_API_KEY;

type Image = {
  title: string;
  explanation: string;
  media_type: 'image' | 'video';
  /** Date published in YYYY-MM-DD format */
  date: string;
  /** Video URL or standard resolution image URL */
  url: string;
  /** High-res image URL (for media_type: 'image' only) */
  hdurl?: string;
  /** API version. Defaults to "v1" */
  service_version: string;
}

const { imageDate } = Astro.params;

 const image = await fetch(
   `https://api.nasa.gov/planetary/apod?api_key=${NASA_API_KEY}&date=${imageDate}`
 ).then(res => res.json());

---

<SpaceLayout title={new Date(imageDate).toLocaleDateString()}>
  <main>
    <h1>{image.title}</h1>
   <Image title={image.title} url={image.url} alt={image.explanation} media_type={image.media_type}>
    <div slot="figcaption">
      <p class='date'>
      {new Date(image.date).toLocaleDateString()}
      </p>
      {image.explanation}
      <p></p>
    </div>
    </Image>
  </main>
</SpaceLayout>

<style>
  h1 {
    margin: 2rem 0;
  }

  main {
    margin: auto;
    padding: 1em;
    max-width: 64ch;
  }

  .date {
    text-align: right;
    font-weight: right;
  }
</style>